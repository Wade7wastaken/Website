const linksperpage=100;let linknames=[],emugames,page=0,games=[],matches=[],filteredsites=[];console.log("Advanced features:"),console.log('Set local storage "origin" to "0" to run the emulator hosted on this domain, and "1" to run it from GitHub.'),console.log('Set local storage "emuWidth" and "emuHeight" to set a custom size for EmulatorJS.');const mainPrm=(async()=>{await fetchLinks(),getLocalStorage(),loadEmuGames(),addSiteSelectors(),sortLinks(),renderLinks(),updateTabs(localStorage.openTab)})();async function fetchLinks(){function t(e){var t=document.createElement("a");for(const n in e){linknames.push(n);var a=e[n];if("flash"==n)for(const o of a)"string"!=typeof o&&(games.push([o[0],"./ruffle.html?game="+o[1],"Flash (Ruffle)","local"]),games.push([o[0],"./waflash.html?game="+o[1],"Flash (WAFlash)","local"]));else for(const s of a)t.href=s[1],games.push([s[0],s[1],n,t.hostname])}}await Promise.all((()=>{let e=[];return[["scrapelinks",t],["customlinks",t],["emugames",e=>{emugames=e}]].forEach(t=>{e.push(fetch(`./data/${t[0]}.json`).then(e=>e.json()).then(e=>{t[1](e)}).catch(e=>{throw new Error(`Error fetching ${t[0]}: `+e)}))}),e})()).then(()=>{games.sort(),(linknames=linknames.concat(["Flash (Ruffle)","Flash (WAFlash)"]).remove("flash").sort()).remove("Other"),linknames.push("Other")})}function getLocalStorage(){switch(localStorage.openTab||(localStorage.openTab="NES"),"1"==localStorage.oldCores&&(getId("coretoggle").className+=" active"),localStorage.emu){case"EJS":getId("emulatortoggle").textContent="EmulatorJS";break;case"NJS":getId("emulatortoggle").textContent="NeptunJS",getId("coretoggle").style.display="none";break;default:getId("emulatortoggle").textContent="EmulatorJS"}}async function updateTabs(t){await mainPrm,localStorage.openTab=t;var a=getClass("tabcontent");for(let e=0;e<a.length;e++)a[e].style.display="none";getId(t).style.display="block";var n=getClass("tabbuttons");for(let e=0;e<n.length;e++)n[e].className=n[e].className.replace(" active",""),n[e].className.includes(t)&&(n[e].className+=" active");var e,o="Web"==t?"none":"inline";for(e of getClass("webhidden"))e.style.display=o}function loadEmuGames(){var e=getId("buttonparent"),t=document.createElement("button"),a=document.createElement("li"),n=document.createElement("a");a.append(n);for(const i in emugames){var o=emugames[i],s=(t.textContent=o.name,t.className="tabbuttons "+i,t.setAttribute("onclick",`updateTabs("${i}")`),e.append(t.cloneNode(!0)),getId(i));quickAppend("h2",s,o.name);for(const m in o.games){var l=o.games[m];quickAppend("h3",s,m);for(const g in l){category=l[g],"main"!=g&&quickAppend("h4",s,g);var r=document.createElement("ul");for(const u of category)n.textContent=u.name,n.href=`game.html?ver=${o.consolename}&game=`+u.rom,r.append(a.cloneNode(!0));s.append(r)}}}var c=document.createElement("button");c.textContent="Web",c.className="tabbuttons Web",c.setAttribute("onclick",'updateTabs("Web")'),e.append(c)}function loadLinks(){var e=document.createElement("a");for(const a in links){var t=links[a];if("flash"==a)for(const n of t)games.push([n[0],"./ruffle.html?game="+n[1],"Flash (Ruffle)","local"]),games.push([n[0],"./waflash.html?game="+n[1],"Flash (WAFlash)","local"]);else for(const o of t)e.href=o[1],games.push([o[0],o[1],a,e.hostname])}games.sort()}function addSiteSelectors(){const t=document.getElementById("siteselector"),a=document.createElement("button");a.className="buttonslim",a.setAttribute("onclick","togglesites(event);"),linknames.forEach(e=>{a.textContent=e,a.setAttribute("data",e),t.appendChild(a.cloneNode(!0))})}function sortLinks(){matches=[];for(const e of games)e[0].toLowerCase().includes(getId("websearch").value.toLowerCase())&&!filteredsites.includes(e[2])&&matches.push(e)}function renderLinks(){var e=getId("webgames"),t=(e.innerHTML="",document.createElement("div")),a=(t.className="webcontent",document.createElement("a")),n=(a.className="weblinks",a.setAttribute("target","_blank"),document.createElement("p")),o=(n.className="domainname",t.appendChild(a),t.appendChild(n),page*linksperpage);for(const s of matches.slice(o,o+linksperpage))a.textContent=s[0]+" - "+s[2],a.href=s[1],a.style.color="hsl("+360/linknames.length*linknames.indexOf(s[2])+", 100%, 85%)",n.textContent="("+s[3]+")",e.appendChild(t.cloneNode(!0));o=getClass("pagedisplay");Array.from(o).forEach(e=>{e.textContent=`Page ${page+1} of `+(Math.floor(matches.length/linksperpage)+1)})}async function toggleEmulator(){await mainPrm;var e=getId("emulatortoggle");"EmulatorJS"==e.textContent?(localStorage.emu="NJS",e.textContent="NeptunJS",getId("coretoggle").style.display="none"):(localStorage.emu="EJS",e.textContent="EmulatorJS",getId("coretoggle").style.display="inline-block")}async function toggleoldcores(){await mainPrm;var e=getId("coretoggle"),t=e.className.split(" ");t.includes("active")?(t.remove("active"),localStorage.oldCores="0"):(localStorage.oldCores="1",t.push("active")),e.className=t.join(" ")}async function togglesites(e){await mainPrm;var e=e.currentTarget,t=e.className.split(" ");t.includes("active")?(t.remove("active"),filteredsites.remove(e.attributes.data.nodeValue)):(t.push("active"),filteredsites.push(e.attributes.data.nodeValue)),e.className=t.join(" "),onSearchInput()}async function nextPage(){await mainPrm,page!=Math.floor(matches.length/linksperpage)&&(page+=1,renderLinks())}async function prevPage(){await mainPrm,0!=page&&(--page,renderLinks())}async function onSearchInput(){await mainPrm,page=0,sortLinks(),renderLinks()}async function randomGame(){await mainPrm,window.open(matches[Math.floor(Math.random()*matches.length)][1])}